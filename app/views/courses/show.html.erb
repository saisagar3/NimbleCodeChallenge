<p id="notice"><%= notice %></p>

<h2>Course: <%= @course.course_name %></h2>
<% if current_user.Instructor? %>
  <%= link_to 'Edit', edit_course_path(@course) %> 
  <%= link_to 'Destroy', @course, method: :delete, data: { confirm: 'Are you sure?' }%>
  <%= link_to "Subscribers", subscribers_course_path(@course), method: :get%> <br>
<% end %>

<p>
<% if @course.subscribed?(current_user) %>
  <%= link_to "Leave Course", unsubscribe_course_path(@course), method: :delete%>
<% else %>
  <%= link_to "Join Course", subscribe_course_path(@course), method: :post%>
<% end %>
<%= link_to 'Back', courses_path%>
</p>


<% if  @course.subscribed? current_user %>
  <% if @group.nil?  %>
    Group not assigned yet.
  <% else %>
    <%= link_to "Your Group", @group, method: :get, class: 'btn btn btn-primary' %> <br><br>
  <% end %>
<% end %>

<% if current_user.Instructor? %>
  <h2>Groups</h2>


  <table class="table table-hover">
    <thead>
      <tr>
        <th>Name</th>
        <th>Number of Students</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @course.groups.each do |group| %>
        <tr>
          <td><%= link_to group.name, group %></td>
          <td><%= group.subscribers.includes(:user).where(users: {role: User.Student}).count %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <br>

  <%= link_to 'New Group', new_group_course_path(@course), class: 'btn btn-primary' %>
<% end %>
